<!DOCTYPE html>
<html lang="en" ng-app='nameApp'>
    <head>
        <title></title>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="main.css">
        <script src="js/angular/angular.js"></script>
        <script src="js/angular-route/angular-route.js"></script>
    </head>

    <body>
      <div class='container'>
        <h3>nameApp</h3>
        <div>
          <ng-view></ng-view>
        </div>
      </div>
    </body>
    <script>
        var nameApp = angular.module("nameApp", ["ngRoute"]);

        nameApp.config(["$routeProvider", function($routeProvider){
            $routeProvider
            .when("/main", {
                controller: "MainController",
                templateUrl: "partials/_main.html"
            })
            .when('/:index', {
              controller: "UserController",
              templateUrl: "partials/_user.html"
            })
            .when('/:index/edit', {
              controller: "UserController",
              templateUrl: "partials/_edit.html"
            })
            .otherwise({
              redirectTo: '/main'
            })
        }]);
        // MainFactory
        nameApp.factory("MainFactory", function(){
          console.log('MainFactory loaded');
          var names = [
            { name: "Richard", age: 23 },
            { name: "Kelda", age: 21 },
            { name: "Quinten", age: 22 },
          ];
          var factory = {};
          factory.getNames = function(callback){
            callback(names);
          };
          factory.getOneName = function(callback){
            callback(names);
          };
          factory.deleteUser = function(idx){
            console.log("- remove @ index",idx);
            names.splice(idx, 1);
          }
          return factory;
        });
        // MainController
        nameApp.controller('MainController', ['$scope', 'MainFactory', function($scope, MainFactory){
          console.log('MainController loaded');
          $scope.names = [];
          MainFactory.getNames(function(data){
            $scope.names = data;
          });
          $scope.addName = function(){
            $scope.names.push($scope.newName);
            $scope.newName = {};
          };
        }]);
        // UserController
        nameApp.controller('UserController', ['$scope', 'MainFactory', '$routeParams', function($scope, MainFactory, $routeParams){
          console.log('UserController loaded');
          $scope.name = {};
          $scope.deleteName = function(){
            MainFactory.deleteUser( $routeParams.index );
          }
          MainFactory.getOneName(function(data){
            // To get a single user from the names array of objects in the
            // MainFactory, I have to get the value of the index key...
            $scope.name = data[$routeParams.index];
          });
        }]);
    </script>
</html>
